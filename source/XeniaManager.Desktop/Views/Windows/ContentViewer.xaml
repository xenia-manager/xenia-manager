<ui:FluentWindow x:Class="XeniaManager.Desktop.Views.Windows.ContentViewer"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:converters="clr-namespace:XeniaManager.Desktop.Converters"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:local="clr-namespace:XeniaManager.Desktop.Views.Windows"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:model="clr-namespace:XeniaManager.Desktop.ViewModel.Windows"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 Title="Xenia Manager - Content Viewer"
                 Width="500"
                 Height="600"
                 ResizeMode="NoResize"
                 WindowStartupLocation="CenterScreen"
                 mc:Ignorable="d">
    <Window.Resources>
        <converters:AchievementDescriptionConverter x:Key="AchievementDescriptionConverter" />
        <HierarchicalDataTemplate DataType="{x:Type model:FileItem}" ItemsSource="{Binding Children}">
            <TextBlock Text="{Binding Name}" />
        </HierarchicalDataTemplate>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <!--  Titlebar  -->
        <ui:TitleBar Title="{Binding WindowTitle}"
                     Grid.Row="0"
                     FontSize="16"
                     ShowMaximize="False"
                     ShowMinimize="False">
            <ui:TitleBar.Icon>
                <ui:ImageIcon Source="{Binding WindowIcon}" />
            </ui:TitleBar.Icon>
        </ui:TitleBar>

        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <StackPanel Grid.Row="0" Orientation="Horizontal">
                <ComboBox x:Name="CmbContentTypeList"
                          MinWidth="243.4"
                          Margin="10,10,5,10"
                          DisplayMemberPath="Key"
                          FontSize="18"
                          ItemsSource="{Binding ContentFolders}"
                          SelectedValue="{Binding SelectedContentType}"
                          SelectedValuePath="Value"
                          SelectionChanged="CmbContentTypeList_SelectionChanged" />
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="BtnOpenFolder"
                            Margin="10,0,5,0"
                            Click="BtnOpenFolder_Click"
                            ToolTip="{DynamicResource ContentViewer_OpenFolderButtonTooltip}"
                            Visibility="{Binding IsNotAchievementsVisible}">
                        <Button.Content>
                            <ui:SymbolIcon FontSize="24" Symbol="Folder24" />
                        </Button.Content>
                    </Button>
                    <Button x:Name="BtnDelete"
                            Margin="5,0"
                            Click="BtnDelete_Click"
                            ToolTip="{DynamicResource ContentViewer_DeleteButtonTooltip}"
                            Visibility="{Binding IsNotAchievementsVisible}">
                        <Button.Content>
                            <ui:SymbolIcon FontSize="24" Symbol="Delete24" />
                        </Button.Content>
                    </Button>
                    <Button x:Name="BtnExportSave"
                            Margin="5,0"
                            Click="BtnExportSave_Click"
                            ToolTip="{DynamicResource ContentViewer_ExportSavesButtonTooltip}"
                            Visibility="{Binding IsSavedGameVisible}">
                        <Button.Content>
                            <ui:SymbolIcon FontSize="24" Symbol="SaveArrowRight24" />
                        </Button.Content>
                    </Button>
                    <Button x:Name="BtnImportSave"
                            Margin="5,0,10,0"
                            Click="BtnImportSave_Click"
                            ToolTip="{DynamicResource ContentViewer_ImportSavesButtonTooltip}"
                            Visibility="{Binding IsSavedGameVisible}">
                        <Button.Content>
                            <ui:SymbolIcon FontSize="24" Symbol="SaveMultiple24" />
                        </Button.Content>
                    </Button>
                    <UniformGrid Columns="3" Visibility="{Binding IsUnlockAchievementsVisible}">
                        <Button Margin="5,0,0,0"
                                Click="BtnUnlockAllAchievements_Click"
                                ToolTip="{DynamicResource ContentViewer_ButtonUnlockAllAchievementsTooltip}">
                            <Button.Content>
                                <ui:SymbolIcon FontSize="24" Symbol="LockOpen24" />
                            </Button.Content>
                        </Button>
                        <Button Margin="5,0,0,0"
                                Click="BtnLockAllAchievements_Click"
                                ToolTip="{DynamicResource ContentViewer_ButtonLockAllAchievementsTooltip}">
                            <Button.Content>
                                <ui:SymbolIcon FontSize="24" Symbol="LockClosed24" />
                            </Button.Content>
                        </Button>
                        <Button Margin="5,0,10,0"
                                Click="BtnSaveAchievementChanges_Click"
                                ToolTip="{DynamicResource ContentViewer_ButtonSaveAchievementChangesTooltip}">
                            <Button.Content>
                                <ui:SymbolIcon FontSize="24" Symbol="Save24" />
                            </Button.Content>
                        </Button>
                    </UniformGrid>
                </StackPanel>
            </StackPanel>

            <Grid x:Name="GrdGamerProfiles"
                  Grid.Row="1"
                  VerticalAlignment="Center"
                  Visibility="{Binding GamerProfilesVisibility}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <ComboBox x:Name="CmbGamerProfiles"
                          Grid.Column="0"
                          Margin="10,0,5,10"
                          FontSize="18"
                          ItemsSource="{Binding Profiles}"
                          SelectedItem="{Binding SelectedProfile, Mode=TwoWay}"
                          SelectedValuePath="OfflineXuid"
                          SelectionChanged="CmbGamerProfiles_SelectionChanged" />
                <Button Grid.Column="1"
                        Margin="5,0,10,10"
                        Click="BtnEditProfileInfo_Click"
                        IsEnabled="{Binding ProfileSelected}"
                        ToolTip="{DynamicResource ContentViewer_EditProfileButtonTooltip}">
                    <Button.Content>
                        <ui:SymbolIcon FontSize="24" Symbol="PersonEdit24" />
                    </Button.Content>
                </Button>
                <Button Grid.Column="2"
                        Margin="5,0,10,10"
                        Click="BtnDeleteProfile_Click"
                        IsEnabled="{Binding ProfileSelected}"
                        ToolTip="{DynamicResource ContentViewer_DeleteProfileButtonTooltip}">
                    <Button.Content>
                        <ui:SymbolIcon FontSize="24" Symbol="PersonDelete24" />
                    </Button.Content>
                </Button>
            </Grid>
            <Separator Grid.Row="2" Margin="0,4,0,2" />
            <ScrollViewer Grid.Row="3" Visibility="{Binding IsTreeViewVisible}">
                <TreeView x:Name="TvwInstalledContentTree"
                          Margin="10,0"
                          AllowDrop="True"
                          ItemsSource="{Binding Files}"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                          ScrollViewer.VerticalScrollBarVisibility="Disabled">
                    <TreeView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel />
                        </ItemsPanelTemplate>
                    </TreeView.ItemsPanel>
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <TextBlock Text="{Binding Name}" ToolTip="{Binding FullPath}" />
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </ScrollViewer>
            <ScrollViewer Grid.Row="3" Visibility="{Binding IsAchievementsVisible}">
                <ItemsControl x:Name="IcAchievementsList"
                              Focusable="True"
                              GotFocus="IcAchievementsList_GotFocus"
                              ItemsSource="{Binding Achievements}"
                              LostFocus="IcAchievementsList_LostFocus">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{DynamicResource PatchSettingBorder}">
                                <Grid Height="60">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="400" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0"
                                               Style="{DynamicResource PatchSettingTextBlock}"
                                               Text="{Binding Name}">
                                        <TextBlock.ToolTip>
                                            <ToolTip>
                                                <TextBlock>
                                                    <TextBlock.Text>
                                                        <MultiBinding Converter="{StaticResource AchievementDescriptionConverter}">
                                                            <Binding Path="IsUnlocked" />
                                                            <Binding Path="UnlockedDescription" />
                                                            <Binding Path="LockedDescription" />
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </ToolTip>
                                        </TextBlock.ToolTip>
                                    </TextBlock>
                                    <CheckBox Grid.Column="1"
                                              Click="ChkAchievement_Click"
                                              IsChecked="{Binding IsUnlocked, Mode=OneWay}"
                                              IsEnabled="{Binding DataContext.IsAchievementEditingEnabled, RelativeSource={RelativeSource AncestorType=Window}}"
                                              Style="{DynamicResource PatchSettingCheckBox}" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemContainerStyle>
                        <Style>
                            <Setter Property="Control.Margin" Value="0,2,0,2" />
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                </ItemsControl>
            </ScrollViewer>
        </Grid>
    </Grid>
</ui:FluentWindow>