<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:XeniaManager.ViewModels.Pages"
             xmlns:icons="using:FluentIcons.Avalonia.Fluent"
             xmlns:controls="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
             xmlns:itemVm="clr-namespace:XeniaManager.ViewModels.Items"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="XeniaManager.Views.Pages.LibraryPage"
             x:DataType="vm:LibraryPageViewModel">
    <Design.DataContext>
        <vm:LibraryPageViewModel />
    </Design.DataContext>

    <!-- UI -->
    <Grid RowDefinitions="64,Auto,*">
        <!-- Search & Menu -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="64" />
            </Grid.ColumnDefinitions>

            <!-- Serach -->
            <TextBox Grid.Column="0"
                     Padding="12,0"
                     VerticalContentAlignment="Center"
                     BorderThickness="0"
                     FontSize="24"
                     Watermark="{DynamicResource LibraryPage.Search.Watermark}" />

            <!-- Menu -->
            <Button Grid.Column="1"
                    Background="Transparent"
                    BorderThickness="0"
                    Cursor="Hand"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch">
                <icons:SymbolIcon Symbol="MoreVertical" />
                <Button.Flyout>
                    <MenuFlyout Placement="BottomEdgeAlignedRight">
                        <!-- Edit Grid View -->
                        <MenuItem Header="{DynamicResource LibraryPage.Options.EditGridView.Header}"
                                  ToolTip.Tip="{DynamicResource LibraryPage.Options.EditGridView.Tooltip}">
                            <MenuItem.Icon>
                                <icons:SymbolIcon Symbol="Eye" />
                            </MenuItem.Icon>
                            <!-- Game Title -->
                            <MenuItem Header="{DynamicResource LibraryPage.Options.EditGridView.Title.Header}"
                                      Command="{Binding ToggleGameTitleCommand}">
                                <MenuItem.Icon>
                                    <icons:SymbolIcon Symbol="SlideTextTitle" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <!-- Compatibility Rating -->
                            <MenuItem Header="{DynamicResource LibraryPage.Options.EditGridView.CompatibilityRating.Header}"
                                      Command="{Binding ToggleCompatibilityRatingCommand}">
                                <MenuItem.Icon>
                                    <icons:SymbolIcon Symbol="WindowDevTools" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </MenuItem>
                        <Separator />
                        <!-- Scan Directory -->
                        <MenuItem Header="{DynamicResource LibraryPage.Options.ScanDirectory.Header}"
                                  Command="{Binding ScanDirectoryCommand}"
                                  ToolTip.Tip="{DynamicResource LibraryPage.Options.ScanDirectory.Tooltip}">
                            <MenuItem.Icon>
                                <icons:SymbolIcon Symbol="FolderAdd" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <!-- Add Game -->
                        <MenuItem Header="{DynamicResource LibraryPage.Options.AddGame.Header}"
                                  Command="{Binding AddGameCommand}">
                            <MenuItem.Icon>
                                <icons:SymbolIcon Symbol="Add" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator />
                        <!-- Export Shortcuts -->
                        <MenuItem Header="{DynamicResource LibraryPage.Options.ExportShortcuts.Header}"
                                  Command="{Binding ExportGameShortcutsCommand}"
                                  ToolTip.Tip="{DynamicResource LibraryPage.Options.ExportShortcuts.Tooltip}">
                            <MenuItem.Icon>
                                <icons:SymbolIcon Symbol="ArrowExport" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
        </Grid>

        <!-- Zoom Slider -->
        <Grid Grid.Row="1" Margin="10,0"
              IsVisible="{Binding IsGridView}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <icons:SymbolIcon Grid.Column="0"
                              Symbol="ZoomOut"
                              FontSize="14"
                              Margin="0,0,8,0" />
            <Slider Grid.Column="1"
                    VerticalAlignment="Center"
                    IsSnapToTickEnabled="True"
                    Maximum="{Binding ZoomMaximum}"
                    Minimum="{Binding ZoomMinimum}"
                    MinHeight="0"
                    Padding="0"
                    TickFrequency="{Binding ZoomTickFrequency}"
                    Value="{Binding ZoomValue}"
                    ToolTip.Tip="{Binding ZoomToolTip}" />
            <icons:SymbolIcon Grid.Column="2"
                              Symbol="ZoomIn"
                              FontSize="14"
                              Margin="8,0,0,0" />
        </Grid>

        <!-- Games (Grid View) -->
        <ScrollViewer Grid.Row="2"
                      Padding="8"
                      IsVisible="{Binding IsGridView}">
            <controls:ItemsRepeater Margin="0,0,10,0"
                                    ItemsSource="{Binding Games}">
                <controls:ItemsRepeater.Layout>
                    <controls:UniformGridLayout MinItemWidth="{Binding MinItemWidth}"
                                                MinItemHeight="{Binding MinItemHeight}"
                                                MinRowSpacing="{Binding ItemSpacing}"
                                                MinColumnSpacing="{Binding ItemSpacing}"
                                                ItemsStretch="Uniform" />
                </controls:ItemsRepeater.Layout>

                <controls:ItemsRepeater.ItemTemplate>
                    <DataTemplate x:DataType="itemVm:GameItemViewModel">
                        <Button Padding="0"
                                BorderThickness="1"
                                Cursor="Hand"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding LaunchCommand}">

                            <Button.ContextFlyout>
                                <MenuFlyout>
                                    <!-- Content -->
                                    <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Content.Header}">
                                        <MenuItem.Icon>
                                            <icons:SymbolIcon Symbol="ContentView" />
                                        </MenuItem.Icon>
                                        <!-- View Installed Content -->
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Content.InstalledContent.Header}"
                                                  Command="{Binding ViewInstalledContentCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="ContentView" />
                                            </MenuItem.Icon>
                                        </MenuItem>
                                        <!-- Screenshots -->
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Content.Screenshots.Header}"
                                                  Command="{Binding ViewScreenshotsCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="Screenshot" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.Content.Screenshots.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                        <!-- Open Save Backup -->
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Content.SaveBackup.Header}"
                                                  Command="{Binding OpenSaveBackupFolderCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="SaveArrowRight" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.Content.SaveBackup.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                    </MenuItem>
                                    <!-- Patches -->
                                    <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Patches.Header}">
                                        <MenuItem.Icon>
                                            <icons:SymbolIcon Symbol="Patch" />
                                        </MenuItem.Icon>
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Patches.Download.Header}"
                                                  IsVisible="{Binding !InstalledPatches}"
                                                  Command="{Binding DownloadPatchesCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="ArrowDownload" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.Patches.Download.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Patches.InstallLocal.Header}"
                                                  IsVisible="{Binding !InstalledPatches}"
                                                  Command="{Binding InstallLocalPatchesCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="AddStarburst" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.Patches.InstallLocal.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Patches.AddAdditional.Header}"
                                                  IsVisible="{Binding InstalledPatches}"
                                                  Command="{Binding AddAdditionalPatchesCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="AddStarburst" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.Patches.AddAdditional.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Patches.Configure.Header}"
                                                  IsVisible="{Binding InstalledPatches}"
                                                  Command="{Binding ConfigurePatchesCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="EditSettings" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.Patches.Configure.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.Patches.Remove.Header}"
                                                  IsVisible="{Binding InstalledPatches}"
                                                  Command="{Binding RemovePatchesCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="Delete" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.Patches.Remove.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                    </MenuItem>
                                    <!-- Create Shortcut -->
                                    <MenuItem Header="{DynamicResource GameButton.ContextFlyout.CreateShortcut.Header}">
                                        <MenuItem.Icon>
                                            <icons:SymbolIcon Symbol="ArrowHookUpLeft" />
                                        </MenuItem.Icon>
                                        <!-- Desktop -->
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.CreateShortcut.Desktop.Header}"
                                                  Command="{Binding CreateDesktopShortcutCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="Desktop" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.CreateShortcut.Desktop.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                        <!-- Steam -->
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.CreateShortcut.Steam.Header}"
                                                  Command="{Binding CreateSteamShortcutCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="Games" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.CreateShortcut.Steam.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                    </MenuItem>
                                    <!-- Open Compatibility Page -->
                                    <MenuItem Header="{DynamicResource GameButton.ContextFlyout.OpenCompatibilityPage.Header}"
                                              Command="{Binding OpenCompatibilityPageCommand}">
                                        <MenuItem.Icon>
                                            <icons:SymbolIcon Symbol="WindowDevTools" />
                                        </MenuItem.Icon>
                                        <ToolTip.Tip>
                                            <TextBlock Text="{DynamicResource GameButton.ContextFlyout.OpenCompatibilityPage.Tooltip}" />
                                        </ToolTip.Tip>
                                    </MenuItem>
                                    <!-- Edit Game -->
                                    <MenuItem Header="{DynamicResource GameButton.ContextFlyout.EditGame.Header}">
                                        <MenuItem.Icon>
                                            <icons:SymbolIcon Symbol="WindowDevTools" />
                                        </MenuItem.Icon>
                                        <!-- Information -->
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.EditGame.Information.Header}"
                                                  Command="{Binding EditGameInformationCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="SlideTextTitleEdit" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.EditGame.Information.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                        <!-- Settings -->
                                        <MenuItem Header="{DynamicResource GameButton.ContextFlyout.EditGame.Settings.Header}"
                                                  Command="{Binding EditGameSettingsCommand}">
                                            <MenuItem.Icon>
                                                <icons:SymbolIcon Symbol="EditSettings" />
                                            </MenuItem.Icon>
                                            <ToolTip.Tip>
                                                <TextBlock Text="{DynamicResource GameButton.ContextFlyout.EditGame.Settings.Tooltip}" />
                                            </ToolTip.Tip>
                                        </MenuItem>
                                    </MenuItem>
                                    <!-- Remove Game Command-->
                                    <MenuItem Header="{DynamicResource GameButton.ContextFlyout.RemoveGame.Header}"
                                              Command="{Binding RemoveGameCommand}">
                                        <MenuItem.Icon>
                                            <icons:SymbolIcon Symbol="Delete" />
                                        </MenuItem.Icon>
                                        <ToolTip.Tip>
                                            <TextBlock Text="{DynamicResource GameButton.ContextFlyout.RemoveGame.Tooltip}" />
                                        </ToolTip.Tip>
                                    </MenuItem>
                                </MenuFlyout>
                            </Button.ContextFlyout>

                            <Grid RowDefinitions="*,Auto">
                                <!-- Shown when boxart exists -->
                                <Image Grid.Row="0"
                                       Source="{Binding Game.Artwork.CachedBoxart}"
                                       Margin="4"
                                       Stretch="Uniform"
                                       IsVisible="{Binding HasBoxart}" />

                                <!-- Shown when boxart is null -->
                                <StackPanel Grid.Row="0"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Center"
                                            Spacing="8"
                                            Margin="8"
                                            IsVisible="{Binding !HasBoxart}">
                                    <icons:SymbolIcon Symbol="XboxController"
                                                      FontSize="48"
                                                      HorizontalAlignment="Center" />
                                    <TextBlock Text="{Binding Title}"
                                               TextAlignment="Center"
                                               TextWrapping="Wrap"
                                               MaxLines="3"
                                               TextTrimming="CharacterEllipsis"
                                               HorizontalAlignment="Center" />
                                </StackPanel>
                            </Grid>
                        </Button>
                    </DataTemplate>
                </controls:ItemsRepeater.ItemTemplate>
            </controls:ItemsRepeater>
        </ScrollViewer>
    </Grid>
</UserControl>